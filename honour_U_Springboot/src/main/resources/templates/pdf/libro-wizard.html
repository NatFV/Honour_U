<!-- src/main/resources/templates/proyectos/libro-wizard.html -->
<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
    <title th:text="${proyecto.nombreProyecto} + ' – Crear libro'">Crear libro</title>
    <th:block layout:fragment="extra_head">
        <style>.card{border:1px solid #eee;border-radius:10px;padding:16px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.05)}</style>
    </th:block>
</head>
<body>
<section layout:fragment="content">
    <h2 th:text="'Crear libro para ' + ${proyecto.nombreProyecto}"></h2>

    <form th:action="@{/proyectos/admin/{t}/libro(t=${proyecto.adminToken})}"
          method="post" th:object="${form}" class="mt-3">

        <div class="card mb-3">
            <div class="fw-semibold mb-2">Datos del libro</div>
            <div class="row g-3">
                <div class="col-md-8">
                    <label class="form-label">Título</label>
                    <input class="form-control" th:field="*{tituloLibro}" required>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Formato</label>
                    <select class="form-select" th:field="*{formato}" required>
                        <option value="PDF">PDF</option>
                        <option value="Tapa blanda">Tapa blanda</option>
                        <option value="Tapa dura">Tapa dura</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label class="form-label">Copias</label>
                    <input type="number" class="form-control" min="1" th:field="*{copias}" required>
                </div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="fw-semibold mb-2">Qué quieres hacer</div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" th:field="*{envioEmail}" id="chkEmail">
                <label class="form-check-label" for="chkEmail">Enviar por email</label>
            </div>
            <div id="panelEmail" class="mt-2" style="display:none">
                <label class="form-label">Email destino</label>
                <input type="email" class="form-control" th:field="*{email}">
            </div>

            <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" th:field="*{envioFisico}" id="chkFisico">
                <label class="form-check-label" for="chkFisico">Crear libro físico y enviar a un destinatario</label>
            </div>
            <div id="panelFisico" class="mt-2" style="display:none">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Nombre</label>
                        <input class="form-control" th:field="*{destinatarioNombre}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Apellido</label>
                        <input class="form-control" th:field="*{destinatarioApellido}">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Teléfono</label>
                        <input class="form-control" th:field="*{telefono}">
                    </div>
                    <div class="col-12"><hr></div>
                    <div class="col-md-4">
                        <label class="form-label">Calle</label>
                        <input class="form-control" th:field="*{calle}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Número</label>
                        <input class="form-control" th:field="*{numero}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Piso</label>
                        <input class="form-control" th:field="*{piso}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Letra</label>
                        <input class="form-control" th:field="*{letra}">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Código Postal</label>
                        <input class="form-control" th:field="*{codigoPostal}">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">País</label>
                        <input class="form-control" th:field="*{pais}">
                    </div>
                </div>
            </div>

            <div class="text-danger small mt-2" th:if="${globalError != null}" th:text="${globalError}"></div>
        </div>

        <div class="d-flex gap-2">
            <a th:href="@{/proyectos/admin/{t}(t=${proyecto.adminToken})}" class="btn btn-outline-secondary">Cancelar</a>
            <button class="btn btn-primary" type="submit">Crear</button>
        </div>
    </form>
</section>

<th:block layout:fragment="scripts">
    <script th:inline="javascript">
        (function(){
            const chkEmail  = document.getElementById('chkEmail');
            const chkFisico = document.getElementById('chkFisico');
            const panelEmail  = document.getElementById('panelEmail');
            const panelFisico = document.getElementById('panelFisico');
            function toggle(){
                panelEmail.style.display  = chkEmail.checked ? '' : 'none';
                panelFisico.style.display = chkFisico.checked ? '' : 'none';
            }
            chkEmail?.addEventListener('change', toggle);
            chkFisico?.addEventListener('change', toggle);
            toggle();
        })();
    </script>
</th:block>
</body>
</html>
